% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sve_from_effect.R
\name{sve_from_effect}
\alias{sve_from_effect}
\title{Symmetric Vaccine Efficacy from Relative Effect Measures}
\usage{
sve_from_effect(
  theta,
  var_log_theta,
  level = 0.95,
  method = c("profile", "tanh-wald", "wald"),
  smooth = TRUE,
  epsilon = NULL
)
}
\arguments{
\item{theta}{Numeric. The relative effect measure (e.g., relative risk from
Poisson regression, hazard ratio from Cox model, etc.). Can be a vector.}

\item{var_log_theta}{Numeric. The estimated variance of log(theta), typically
obtained from model output (e.g., \code{vcov(model)} or the squared standard
error). Must have the same length as \code{theta}.}

\item{level}{Confidence level for the interval (default is 0.95).}

\item{method}{Method used to construct the confidence interval.

One of:
\itemize{
\item \code{"profile"} (default): Profile likelihood-based confidence interval
using a normal approximation for log(theta). The interval inverts
the likelihood ratio test after transforming to the SVE scale. To use
the exact likelihood from a fitted regression model instead of the
normal approximation, see \code{\link[=sve_from_model]{sve_from_model()}}.
\item \code{"tanh-wald"}: Applies a hyperbolic arctangent
transform before forming the Wald interval, then transforms back.
Improves coverage when the estimate is near +/- 1.
\item \code{"wald"}: Standard Wald interval on the untransformed scale.
}}

\item{smooth}{Logical. Should variance smoothing be applied near the null?
Default is TRUE. Only used for Wald-based methods (\code{wald}, \code{tanh-wald}).
Ignored for profile likelihood. Recommended to avoid instability when
effect is near 1.}

\item{epsilon}{Numeric. The smoothing window. Only used for Wald-based
methods (\code{wald}, \code{tanh-wald}) when \code{smooth = TRUE}. If \code{NULL} and
\code{smooth = TRUE}, defaults to \eqn{z_{\alpha/2}
  \sqrt{\hat{p}_0(1-\hat{p}_0)/n_0 + \hat{p}_1(1-\hat{p}_1)/n_1}}
where \eqn{\hat{p}_0 = x_0/n_0}, \eqn{\hat{p}_1 = x_1/n_1}, and
\eqn{z_{\alpha/2}} is the critical value from the standard normal
distribution corresponding to the confidence level.}
}
\value{
A data frame with the following columns:
\describe{
\item{estimate}{The symmetric vaccine efficacy estimate.}
\item{lower}{Lower bound of the confidence interval.}
\item{upper}{Upper bound of the confidence interval.}
\item{level}{Confidence interval level.}
\item{method}{Indicates the method used for the confidence interval.}
}
}
\description{
Computes the symmetric vaccine efficacy (SVE) and associated confidence
intervals from a relative effect measure (e.g., relative risk,
hazard ratio, odds ratio) obtained from a regression model.
}
\details{
The symmetric vaccine efficacy (SVE) from a relative effect measure is:
\deqn{
\text{SVE} = \frac{1 - \theta}{\max(1, \theta)}
}
where \eqn{\theta} is the relative effect measure. When \eqn{\theta < 1},
this simplifies to \eqn{\text{SVE} = 1 - \theta} (protective). When
\eqn{\theta > 1}, it becomes \eqn{\text{SVE} = (1 - \theta)/\theta} (harmful).
}
\examples{
# Example with a hazard ratio from a Cox model
# Suppose: HR = 0.7, SE(log(HR)) = 0.15
hr <- 0.7
se_log_hr <- 0.15
var_log_hr <- se_log_hr^2
sve_from_effect(theta = hr, var_log_theta = var_log_hr)

# With tanh-Wald method
sve_from_effect(theta = hr, var_log_theta = var_log_hr, method = "tanh-wald")

# Example with multiple effect estimates (e.g., from subgroups)
hrs <- c(0.5, 0.8, 1.2)
var_log_hrs <- c(0.04, 0.025, 0.036)
sve_from_effect(theta = hrs, var_log_theta = var_log_hrs)

# Using output directly from a Cox model
\dontrun{
library(survival)
fit <- coxph(Surv(time, status) ~ vaccination + age + baseline_risk,
             data = sim_trial_data)
hr <- exp(coef(fit)["vaccination"])
var_log_hr <- vcov(fit)["vaccination", "vaccination"]
sve_from_effect(theta = hr, var_log_theta = var_log_hr)
}

}
