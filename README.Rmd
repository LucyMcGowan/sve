---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# sve

The goal of sve is to facilitate the calculation of symmetric vaccine efficacy (SVE) and corresponding variance and confidence intervals.

## Installation

You can install the development version of sve like so:

``` r
devtools::install_github("LucyMcGowan/sve")
```

## Example

```{r}
library(sve)
```

The core function, `est_sve()`, computes the symmetric vaccine efficacy and its confidence interval given the event proportions and sample sizes for the vaccinated and unvaccinated groups.

**Example:**

* unvaccinated 10% infection rate  
* vaccinated 5% infection rate  
* $n_0=n_1=1,000$

```{r}
est_sve(x0 = 10, 
        x1 = 5, 
        n0 = 1000, 
        n1 = 1000)
```

By default, confidence intervals are calculated on a transformed scale and then back-transformed in order to ensure that they remain between -1 and 1 (`method = "tanh-wald"`). If you do not want to use this transformation, you can set the option `method = "wald"`:

```{r}
est_sve(x0 = 10, 
        x1 = 5, 
        n0 = 1000, 
        n1 = 1000,
        method = "wald")
```

For small samples or a small number of events exact intervals may be preferred. For these, you can set `method = "exact"`:

```{r}
est_sve(x0 = 10, 
        x1 = 5, 
        n0 = 100, 
        n1 = 100,
        method = "exact")
```

## Using relative effect measures

The `sve_from_effect()` function computes SVE from relative effect measures (e.g., hazard ratios from Cox models, relative risks from Poisson regression). Below is an example using a Cox proportional hazards model and a simulated data set provided in this package (`sim_trial_data`).

```{r, eval = requireNamespace("survival", quietly = TRUE)}
library(survival)

fit <- coxph(Surv(time, status) ~ vaccination + age + baseline_risk, 
             data = sim_trial_data)
hr <- exp(coef(fit)["vaccination"])
var_log_hr <- vcov(fit)["vaccination", "vaccination"]

sve_from_effect(theta = hr, var_log_theta = var_log_hr)
```

## Methods overview

The symmetric vaccine efficacy (SVE) is defined as

$$
\text{SVE}=\frac{2(p_0-p_1)}{p_0+p_1+|p_0-p_1|},
$$
 
where:

* $p_0$ = event proportion in the unvaccinated group  
* $p_1$  = event proportion in the vaccinated group

This formulation ensures the estimator is bounded between -1 and 1. Equivalently, it can be written in terms of a relative effect measure, $\theta$ (such as a relative risk or hazard ratio):

$$
\text{SVE} = \frac{2(1 - \theta)}{1 + \theta + |1 - \theta|}.
$$
